<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢‡∏õ‡∏•‡∏≤‡∏î‡∏∏‡∏Å‡∏ó‡∏≠‡∏î</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
      rel="stylesheet"
    />

    <!-- <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/Order_page.css') }}"
    /> -->
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  </head>
  <style>
    /* Minimal custom CSS for specific adjustments */
    .card {
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .cart-popup {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: white;
      padding: 30px;
      display: none;
      z-index: 999;
    }

    .cart-popup.show {
      display: block;
    }

    .cart-popup-item {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    .cart-popup-item.show {
      display: flex;
    }

    .cart-popup-item .popup-content {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      width: 80%;
      max-width: 600px;
      text-align: center;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    .cart-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 500px;
      height: auto;
      max-height: 80%;
      background-color: #fff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      overflow-y: auto;
      z-index: 999;
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .cart-popup.show {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translate(-50%, -60%);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%);
      }
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #eaeaea;
    }

    .cart-item:last-child {
      border-bottom: none;
    }

    .cart-item span {
      font-size: 16px;
      font-weight: 500;
    }

    .quantity-buttons {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn {
      border-radius: 8px;
    }

    .btn-sm {
      font-size: 14px;
      padding: 6px 12px;
    }

    .btn-danger:hover,
    .btn-warning:hover {
      opacity: 0.85;
    }

    #total-price {
      font-size: 18px;
      color: #333;
    }

    .close-button {
      font-size: 24px;
      position: absolute;
      top: 10px;
      right: 10px;
      color: #333;
    }

    .close-button:hover {
      opacity: 0.7;
    }
    .cart-popup-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent black */
      z-index: 900; /* Just below the cart popup */
      display: none;
    }

    .toast {
      font-size: 1.25rem; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
      border-radius: 10px; /* ‡∏°‡∏∏‡∏°‡πÇ‡∏Ñ‡πâ‡∏á‡∏°‡∏ô */
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* ‡πÄ‡∏á‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πà‡∏ô */
      background-color: #28a745; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏î‡πà‡∏ô */
    }

    .toast-body {
      background-color: #28a745; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏î‡πà‡∏ô */
      color: white;
      font-weight: bold;
      display: flex;
      align-items: center;
    }

    .toast-body i {
      font-size: 1.5rem;
      margin-right: 10px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
    }

    @media (max-width: 768px) {
      .toast {
        font-size: 1rem;
        padding: 10px;
      }

      .toast-body {
        font-size: 1rem;
      }
    }
  </style>
  <body>
    <!-- Toast Notification -->
    <div
      class="toast position-fixed bottom-0 right-0 p-3"
      style="z-index: 1055; bottom: 1rem; right: 1rem"
      id="cart-toast"
      data-delay="2000"
    >
      <div class="toast-body">
        <i class="fas fa-check-circle"></i> ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤!
      </div>
    </div>
    <!-- Toast Notification for item removal -->
    <div
      class="toast position-fixed bottom-0 right-0 p-3"
      style="z-index: 1060; bottom: 1rem; right: 1rem; background-color: red"
      id="remove-toast"
      data-delay="2000"
    >
      <div class="toast-body" style="background-color: red">
        <i class="fas fa-trash-alt"></i> ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤!
      </div>
    </div>
    <!-- Toast Notification for all item removal -->
    <div
      class="toast position-fixed bottom-0 right-0 p-3"
      style="z-index: 1060; bottom: 1rem; right: 1rem; background-color: red"
      id="remove-all-toast"
      data-delay="2000"
    >
      <div class="toast-body" style="background-color: red">
        <i class="fas fa-trash-alt"></i> ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤!
      </div>
    </div>

    <div class="cart-popup-backdrop" id="cart-backdrop"></div>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-danger">
      <a
        class="navbar-brand"
        href="#"
        id="nav-menu"
        onclick="toggleCategoriesNav()"
        >‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ‚¨á</a
      >
      <div class="ml-auto">
        <button class="btn btn-link text-white" onclick="toggleSearchPopup()">
          üîç
        </button>
        <button class="btn btn-link text-white" onclick="toggleCartPopup()">
          üõí <span id="cart-count" class="badge badge-warning">0</span>
        </button>
      </div>
    </nav>

    <!-- Categories Navigation -->
    <div
      class="categories-nav bg-danger p-3"
      id="categories-nav"
      style="display: none"
    ></div>

    <!-- Search Bar -->
    <div
      class="search-bar-bottom bg-danger p-3 justify-content-center"
      id="search-bar-bottom"
      style="display: none"
    >
      <input
        type="text"
        class="form-control"
        id="search-input-bottom"
        placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£..."
      />
      <button class="btn btn-warning ml-2" onclick="toggleSearchPopup()">
        Close
      </button>
    </div>

    <!-- Menu Grid -->
    <!-- <button id="toggle-view-btn" class="btn btn-primary mb-3">
      Switch to List View
    </button> -->
    <div class="container mt-4" id="menu-grid-container"></div>

    <!-- Product Popup -->
    <div class="cart-popup-item" id="product-popup">
      <div class="popup-content">
        <img id="product-image" src="" alt="Product Image" class="img-fluid" />
        <h3 id="product-name" class="mt-3"></h3>
        <p id="product-description"></p>
        <p id="product-price"></p>
        <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏° input ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
        <div class="form-group">
          <label for="quantity-input">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:</label>
          <input
            type="number"
            id="quantity-input"
            class="form-control"
            value="1"
            min="1"
          />
        </div>
        <button class="btn btn-warning mt-2" onclick="closeProductPopup()">
          ‡∏õ‡∏¥‡∏î
        </button>
        <button
          id="add-from-popup"
          class="btn btn-warning mt-2"
          onclick="addToCartFromPopup()"
        >
          ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
        </button>
      </div>
    </div>

    <!-- Cart Popup -->
    <div class="cart-popup" id="cart-popup">
      <button
        class="close-button btn btn-link text-dark float-right"
        onclick="toggleCartPopup()"
      >
        √ó
      </button>
      <h2>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
      <div id="cart-items"></div>
      <div class="text-right">
        <div id="total-price" class="mt-3 font-weight-bold">
          ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: 0 ‡∏ö‡∏≤‡∏ó
        </div>
        <button class="btn btn-danger" onclick="clearcart()">üóëÔ∏è ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        <button class="btn btn-warning" onclick="checkout()">
          ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
        </button>
      </div>
    </div>

    <script>
      let menuItems = []; // Array to store menu items
      let cart = JSON.parse(localStorage.getItem("cart")) || [];

      $(document).ready(function () {
        (function () {
          $.getJSON("/menu/menus", populate_table);
        })();
        updateCart(); // Update the cart count

        // Add event listener for search input
        $("#search-input-bottom").on("input", function () {
          const searchTerm = $(this).val().toLowerCase();
          const filteredItems = menuItems.filter((item) =>
            item.name.toLowerCase().includes(searchTerm)
          );
          renderMenuByCategory(filteredItems);
        });
      });

      // Fetch menu data from the API
      function populate_table(data) {
        menuItems = data;
        renderMenuByCategory();
        renderCategoriesNav();
      }

      // Render categories dynamically
      function renderCategoriesNav() {
        const categoriesNav = $("#categories-nav");
        categoriesNav.empty(); // Clear existing categories

        // Get unique categories from the menu items
        const categories = [...new Set(menuItems.map((item) => item.category))];

        console.log(categories);
        // Add an "All" category option
        categoriesNav.append(`
    <a href="javascript:void(0)" class="d-block text-white mb-2" onclick="filterMenucat('')">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a>
  `);

        // Loop through the unique categories and add them to the navigation
        categories.forEach((category) => {
          categoriesNav.append(`
      <a href="javascript:void(0)" class="d-block text-white mb-2" onclick="filterMenucat('${category}')">${category}</a>
    `);
        });
      }
      function renderMenuByCategory(filteredItems = menuItems) {
        const menuContainer = $("#menu-grid-container");
        menuContainer.empty();

        const groupedByCategory = filteredItems.reduce((acc, item) => {
          acc[item.category] = acc[item.category] || [];
          acc[item.category].push(item);
          return acc;
        }, {});

        Object.keys(groupedByCategory).forEach((category) => {
          const categoryContainer = $("<div>").addClass("mb-4");

          const categoryTitle = $("<h3>")
            .addClass("text-danger font-weight-bold mb-3")
            .text(category);
          categoryContainer.append(categoryTitle);

          const gridContainer = $("<div>").addClass("row");

          groupedByCategory[category].forEach((item) => {
            const cardDiv = $("<div>").addClass(
              "col-md-4 col-sm-6 col-12 mb-4"
            );
            cardDiv.html(`
        <div class="card">
          <img src="${item.image_url}" class="card-img-top" alt="${item.name}">
          <div class="card-body">
            <h5 class="card-title">${item.name}</h5>
            <p class="card-text">‡∏£‡∏≤‡∏Ñ‡∏≤: ${item.price} ‡∏ö‡∏≤‡∏ó</p>
            <div class="form-group">
              <label for="quantity-input-${item.id}">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:</label>
              <input
                type="number"
                id="quantity-input-${item.id}"
                class="form-control"
                value="1"
                min="1"
              />
            </div>
            <button class="btn btn-warning btn-block" onclick="addToCart(${item.id}, parseInt($('#quantity-input-${item.id}').val(), 10))">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
            <button class="btn btn-outline-secondary btn-block" onclick="showProductPopup(${item.id})">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
          </div>
        </div>
      `);
            gridContainer.append(cardDiv);
          });

          categoryContainer.append(gridContainer);
          menuContainer.append(categoryContainer);
        });
      }

      // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô addToCart ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
      function addToCart(itemId, quantity = 1) {
        const item = menuItems.find((menuItem) => menuItem.id === itemId);
        if (!item) return;

        const existingItem = cart.find((cartItem) => cartItem.id === itemId);
        if (existingItem) {
          existingItem.quantity += quantity;
        } else {
          cart.push({ ...item, quantity: quantity });
        }

        updateCart();
        showAddToCartToast(); // Show toast when item is added
      }

      // Update cart function
      function updateCart() {
        localStorage.setItem("cart", JSON.stringify(cart));

        // Calculate total quantity of items in cart
        const totalQuantity = cart.reduce(
          (acc, item) => acc + item.quantity,
          0
        );
        $("#cart-count").text(totalQuantity);

        renderCart();
      }

      // Render cart function
      function renderCart() {
        const cartItemsDiv = $("#cart-items");
        const totalPriceDiv = $("#total-price");

        cartItemsDiv.empty();
        let totalPrice = 0;

        cart.forEach((item) => {
          const cartItemDiv = $("<div>").addClass("cart-item");
          cartItemDiv.html(`
            <span>${item.name}</span>
            <div class="quantity-buttons">
              <button class="btn btn-sm btn-danger" onclick="changeQuantity(${item.id}, -1)">-</button>
              <span>${item.quantity}</span>
              <button class="btn btn-sm btn-success" onclick="changeQuantity(${item.id}, 1)">+</button>
              <button class="btn btn-sm btn-danger" onclick="removeItem(${item.id})">üóëÔ∏è</button>
            </div>
          `);
          cartItemsDiv.append(cartItemDiv);
          totalPrice += item.price * item.quantity;
        });

        totalPriceDiv.text(`‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalPrice} ‡∏ö‡∏≤‡∏ó`);
      }

      // Change quantity function
      function changeQuantity(itemId, change) {
        const item = cart.find((cartItem) => cartItem.id === itemId);
        if (!item) return;

        item.quantity += change;
        if (item.quantity <= 0) {
          cart = cart.filter((cartItem) => cartItem.id !== itemId);
        }
        updateCart();
      }

      // Remove item function
      function removeItem(itemId) {
        cart = cart.filter((cartItem) => cartItem.id !== itemId);
        updateCart();
        showRemoveFromCartToast(); // Show toast when item is removed
      }

      // Checkout function
      function checkout() {
        alert("‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß!");
        cart = [];
        updateCart();
        toggleCartPopup();
      }

      // Clear cart function
      function clearcart() {
        cart = [];
        updateCart();
        showRemoveallFromCartToast(); // Show toast when all items are removed
      }

      // Toggle search popup function
      function toggleSearchPopup() {
        $("#search-bar-bottom").css("display", function (i, v) {
          return v === "none" ? "flex" : "none";
        });
        $("#search-input-bottom").focus();
      }

      // Toggle cart popup function
      function toggleCartPopup() {
        $("#cart-popup").toggleClass("show");
        $("#cart-backdrop").toggle(); // Show or hide the backdrop
      }

      // Toggle categories navigation function
      function toggleCategoriesNav() {
        $("#categories-nav").toggle();
      }

      // Filter menu by category
      function filterMenucat(category) {
        let filteredItems = menuItems;
        if (category) {
          filteredItems = menuItems.filter(
            (item) => item.category === category
          );
        }
        renderMenuByCategory(filteredItems);
        toggleCategoriesNav();
      }

      // Show product popup function
      function showProductPopup(productId) {
        const product = menuItems.find((item) => item.id === productId);
        if (!product) return;

        // Display product details in the popup
        $("#product-image").attr("src", product.image_url);
        $("#product-name").text(product.name);
        $("#product-description").text(`‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ${product.name}`);
        $("#product-price").text(`‡∏£‡∏≤‡∏Ñ‡∏≤: ${product.price} ‡∏ö‡∏≤‡∏ó`);
        $("#add-from-popup").data("product-id", productId);

        // Open the popup
        $("#product-popup").addClass("show");
      }

      // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô addToCartFromPopup ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å input
      function addToCartFromPopup() {
        const productId = $("#add-from-popup").data("product-id");
        const quantity = parseInt($("#quantity-input").val(), 10);

        if (quantity > 0) {
          addToCart(productId, quantity);
          // closeProductPopup();
          showAddToCartToast(); // Show toast here as well
        } else {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0");
        }
      }

      // Close product popup function
      function closeProductPopup() {
        $("#product-popup").removeClass("show");
      }
      // Function to show toast notification
      function showAddToCartToast() {
        $("#cart-toast").toast("show");
      }
      // Function to show toast notification when an item is removed from the cart
      function showRemoveFromCartToast() {
        $("#remove-toast").toast("show");
      }
      // Function to show toast notification when an item is removed from the cart
      function showRemoveallFromCartToast() {
        $("#remove-all-toast").toast("show");
      }
    </script>
  </body>
</html>
