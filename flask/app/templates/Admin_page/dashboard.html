{% extends 'Admin_page/base.html' %} {% block content %}

<!-- <div class="row">
  <div class="card">
    <div class="card-header">Dashboard</div>
  </div>
</div> -->
<div class="row">
  <div class="columns">
    <div class="column">
      <div class="card">
        <header class="card-header">
          <p class="card-header-title">Total sale</p>
        </header>
        <div class="card-content">

        </div>
      </div>
    </div>
    <div class="column">
      <div class="card">
        <header class="card-header">
          <p class="card-header-title">Order count</p>
        </header>
        <div class="card-content"></div>
      </div>
    </div>
    <div class="column">
      <div class="card">
        <header class="card-header">
          <p class="card-header-title">Test case</p>
        </header>
        <div class="card-content">

        </div>
      </div>
    </div>
  </div>
</div>

<div class="columns is-multiline">

    <div class="column is-full-mobile is-half-desktop">
        <h1 class="title has-text-black has-text-centered-touch">10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°</h1>
        <div class="box">
            <canvas id="top10MenuChart" style="height: 400px;"></canvas>
        </div>
    </div>


    <div class="column is-full-mobile is-half-desktop">
        <h1 class="title has-text-black has-text-centered-touch">10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h1>
        <div class="box">
            <canvas id="top10RevenueChart" style="height: 400px;"></canvas>
        </div>
    </div>

   
    <div class="column is-full-mobile is-half-desktop">
        <h1 class="title has-text-black has-text-centered-touch">10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h1>
        <div class="box">
            <canvas id="top10WorseMenuChart" style="height: 400px;"></canvas>
        </div>
    </div>


    <div class="column is-full-mobile is-half-desktop">
        <h1 class="title has-text-black has-text-centered-touch">10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h1>
        <div class="box">
            <canvas id="top10ExpensiveMenuChart" style="height: 400px;"></canvas>
        </div>
    </div>

</div>
{% endblock %} {% block extra_js %}
<!-- ‚úÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- total -->
<script>
  $(document).ready(function () {
    $.getJSON("/menus/get_all_menus", function (data) {
      // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Total Sale
      const totalSale = data.reduce((acc, menu) => acc + (menu.ordered * menu.price), 0);
  
      // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°
      $("#totalSale").text(`‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°: ${totalSale.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
    });
  });
  
</script>




<script>
  $(document).ready(function () {
    $.getJSON("/menus/get_all_menus", function (data) {
      // üéØ ‡∏Å‡∏£‡∏≤‡∏ü 10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏° (‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á)
      const top10Popular = [...data]
        .sort((a, b) => b.ordered - a.ordered)
        .slice(0, 10);
      renderChart(
        "top10MenuChart",
        top10Popular.map((m) => m.name),
        top10Popular.map((m) => m.ordered),
        "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á",
        "10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°",
        "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á (‡∏Ñ‡∏£‡∏±‡πâ‡∏á)",
        "‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π",
        "rgba(75, 192, 192, 0.5)",
        "rgba(75, 192, 192, 1)"
      );

      // üí∞ ‡∏Å‡∏£‡∏≤‡∏ü 10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
      const top10Revenue = [...data]
        .sort((a, b) => b.ordered * b.price - a.ordered * a.price)
        .slice(0, 10);
      renderChart(
        "top10RevenueChart",
        top10Revenue.map((m) => m.name),
        top10Revenue.map((m) => m.ordered * m.price),
        "‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)",
        "10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î",
        "‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (‡∏ö‡∏≤‡∏ó)",
        "‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π",
        "rgba(54, 162, 235, 0.5)",
        "rgba(54, 162, 235, 1)"
      );

      // ‚ùå ‡∏Å‡∏£‡∏≤‡∏ü 10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
      const top10Worse = [...data]
        .sort((a, b) => a.ordered - b.ordered)
        .slice(0, 10);
      renderChart(
        "top10WorseMenuChart",
        top10Worse.map((m) => m.name),
        top10Worse.map((m) => m.ordered),
        "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á (‡πÑ‡∏°‡πà‡∏ô‡∏¥‡∏¢‡∏°)",
        "10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î",
        "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á (‡∏Ñ‡∏£‡∏±‡πâ‡∏á)",
        "‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π",
        "rgba(255, 99, 132, 0.5)",
        "rgba(255, 99, 132, 1)"
      );

      // üíé ‡∏Å‡∏£‡∏≤‡∏ü 10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
      const top10Expensive = [...data]
        .sort((a, b) => b.price - a.price)
        .slice(0, 10);
      renderChart(
        "top10ExpensiveMenuChart",
        top10Expensive.map((m) => m.name),
        top10Expensive.map((m) => m.price),
        "‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)",
        "10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î",
        "‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)",
        "‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π",
        "rgba(255, 206, 86, 0.5)",
        "rgba(255, 206, 86, 1)"
      );
    });

    // üìä ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° DRY
    function renderChart(
      canvasId,
      labels,
      data,
      datasetLabel,
      chartTitle,
      yAxisLabel,
      xAxisLabel,
      bgColor,
      borderColor
    ) {
      const ctx = document.getElementById(canvasId).getContext("2d");
      new Chart(ctx, {
        type: "bar",
        data: {
          labels: labels,
          datasets: [
            {
              label: datasetLabel,
              data: data,
              backgroundColor: bgColor,
              borderColor: borderColor,
              borderWidth: 1,
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: {
              display: true,
              text: chartTitle,
              font: { size: 18 },
            },
            tooltip: {
              callbacks: {
                label: function (context) {
                  return `${datasetLabel}: ${context.parsed.y.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
                },
              },
            },
          },
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: yAxisLabel },
            },
            x: {
              title: { display: true, text: xAxisLabel },
            },
          },
        },
      });
    }
  });
</script>
{% endblock %}
