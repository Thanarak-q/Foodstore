{% extends 'Admin_page/base.html' %} {% block content %}
<div class="container">
  <div class="columns is-vcentered is-justify-content-space-between mt-5">
    <div class="column is-3">
      <h1 class="title">Settings</h1>
    </div>
  </div>

  <div class="card rows mt-5">
    <div class="card-header">
      <h1 class="card-header-title">ตั้งค่าชื่อ</h1>
    </div>
    <div class="card-content">
      <div class="column is-one-third">
        <div class="box">
          <h2 class="subtitle">ชื่อร้านอาหาร</h2>
          <form method="POST" action="/setting">
            <div class="field">
              <label class="label" for="name">name</label>
              <div class="control">
                <input
                  type="text"
                  class="input"
                  id="name"
                  name="name"
                  minlength="0"
                  maxlength="100"
                  step="0.01"
                  value="{{ store.name if store else '' }}"
                />
              </div>
            </div>
            <div class="field">
              <div class="control">
                <button type="submit" class="button is-info">
                  Save Changes
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Sound Settings -->
  <div class="card rows mt-5">
    <div class="card-header">
      <h1 class="card-header-title">ตั้งค่าเสียง</h1>
    </div>
    <div class="card-content">
      <div class="columns is-multiline">
        <!-- Cooking Room Sound -->
        <div class="column is-one-third">
          <div class="box">
            <h2 class="subtitle">เสียงแจ้งเตือนออเดอร์เข้าในห้องครัว</h2>
            <form method="POST" action="/setting" enctype="multipart/form-data">
              <div class="field">
                <label class="label" for="cooking_sound"
                  >Cooking Room Sound (cooking_room.mp3)</label
                >
                <div class="control">
                  <input
                    type="file"
                    class="input"
                    id="cooking_sound"
                    name="cooking_sound"
                    accept="audio/mp3"
                  />
                </div>
              </div>
              <div class="field">
                <div class="control">
                  <button type="submit" class="button is-info">
                    Upload Cooking Sound
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>

        <!-- Waiter Sound -->
        <div class="column is-one-third">
          <div class="box">
            <h2 class="subtitle">เสียงแจ้งเตือนออเดอร์ทำเสร็จแล้วสำหรับพนักงานเสิฟ</h2>
            <form method="POST" action="/setting" enctype="multipart/form-data">
              <div class="field">
                <label class="label" for="waiter_sound"
                  >Waiter Sound (waiter.mp3)</label
                >
                <div class="control">
                  <input
                    type="file"
                    class="input"
                    id="waiter_sound"
                    name="waiter_sound"
                    accept="audio/mp3"
                  />
                </div>
              </div>
              <div class="field">
                <div class="control">
                  <button type="submit" class="button is-info">
                    Upload Waiter Sound
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Logo Settings -->
  <div class="card rows mt-5">
    <div class="card-header">
      <h1 class="card-header-title">ตั้งค่าภาพ</h1>
    </div>
    <div class="card-content">
      <div class="column is-one-third">
        <div class="box">
          <h2 class="subtitle">Upload Logo</h2>
          <form method="POST" action="/setting" enctype="multipart/form-data">
            <div class="field">
              <label class="label" for="logo_file">โลโก้ของร้าน</label>
              <div class="control">
                <input
                  type="file"
                  class="input"
                  id="logo_file"
                  name="logo_file"
                  accept="image/jpeg"
                />
              </div>
            </div>
            <div class="field">
              <div class="control">
                <button type="submit" class="button is-info">
                  Upload Logo
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Tax & Service Charge -->
  <div class="card rows mt-5">
    <div class="card-header">
      <h1 class="card-header-title">ตั้งค่าเกี่ยวกับภาษี</h1>
    </div>
    <div class="card-content">
      <div class="columns is-multiline">
      <div class="column is-one-third">
        <div class="box">
          <h2 class="subtitle">ตั้งค่า vat</h2>
          <form method="POST" action="/setting">
            <div class="field">
              <label class="label" for="vat_rate">vat (%)</label>
              <div class="control">
                <input
                  type="number"
                  class="input"
                  id="vat_rate"
                  name="vat_rate"
                  min="0"
                  step="0.01"
                  value="{{ store.vat if store else '' }}"
                />
              </div>
            </div>
            <div class="field">
              <div class="control">
                <button type="submit" class="button is-info">
                  Save Changes
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>

      <div class="column is-one-third">
        <div class="box">
          <h2 class="subtitle">ตั้งค่ารหัสผู้เสียภาษี</h2>
          <form method="POST" action="/setting">
            <div class="field">
              <label class="label" for="Tax_id">Tax ID</label>
              <div class="control">
                <input
                  type="text"
                  class="input"
                  id="Tax_id"
                  name="Tax_id"
                  minlength="13"
                  maxlength="13"
                  step="0.01"
                  value="{{ store.Tax if store else '' }}"
                />
              </div>
            </div>
            <div class="field">
              <div class="control">
                <button type="submit" class="button is-info">
                  Save Changes
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>

      <div class="column is-one-third">
        <div class="box">
          <h2 class="subtitle">ตั้งค่าพร้อมเพลย์</h2>
          <form method="POST" action="/setting">
            <div class="field">
              <label class="label" for="Promptpay_id">Prompt Pay</label>
              <div class="control">
                <input
                  type="text"
                  class="input"
                  id="Tax_id"
                  name="Promptpay_id"
                  minlength="10"
                  maxlength="13"
                  step="0.01"
                  value="{{ store.Promptpay_id if store else '' }}"
                />
              </div>
            </div>
            <div class="field">
              <div class="control">
                <button type="submit" class="button is-info">
                  Save Changes
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
    </div>
  </div>

  <!-- Order Settings -->
  <div class="card rows mt-5">
    <div class="card-header">
      <h1 class="card-header-title">ตั้งค่าเกี่ยวกับออเดอร์</h1>
    </div>
    <div class="card-content">
      <div class="columns is-multiline">
        <div class="column is-one-third">
          <div class="box">
            <h2 class="subtitle">จำนวนเมนูที่สามารถสั่งได้ในหนึ่งออเดอร์</h2>
            <form method="POST" action="/setting">
              <div class="field">
                <input
                  type="number"
                  class="input"
                  name="max_menu"
                  min="1"
                  value="{{ store.Max_Menu_per_Round if store else '' }}"
                />
              </div>
              <div class="field">
                <button type="submit" class="button is-info">Save</button>
              </div>
            </form>
          </div>
        </div>

        <div class="column is-one-third">
          <div class="box">
            <h2 class="subtitle">จำนวนปริมาณอาหารที่สั่งได้หนึ่งครั้งในหนึ่งเมนู</h2>
            <form method="POST" action="/setting">
              <div class="field">
                <input
                  type="number"
                  class="input"
                  name="max_food_quantity"
                  min="1"
                  value="{{ store.Max_Food_Quantity_per_Order if store else '' }}"
                />
              </div>
              <div class="field">
                <button type="submit" class="button is-info">Save</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<script src="{{ url_for('static', filename='js/notification.js') }}"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
      form.addEventListener('submit', function (e) {
        e.preventDefault(); // ป้องกันการส่งฟอร์มแบบปกติ
  
        const formData = new FormData(form); // สร้าง FormData จากฟอร์ม
        const actionUrl = form.action; // URL ที่ฟอร์มจะส่งข้อมูลไป
        const method = form.method; // HTTP method (POST)
  
        // ส่งข้อมูลด้วย fetch
        fetch(actionUrl, {
          method: method,
          body: formData,
        })
          .then(response => response.json()) // แปลง response เป็น JSON
          .then(data => {
            if (data.success) {
              Swal.fire({
                icon: 'success',
                title: 'สำเร็จ!',
                text: data.message || 'เปลี่ยนแปลงข้อมูลสำเร็จ',
                confirmButtonText: 'ตกลง',
              });
            } else {
              Swal.fire({
                icon: 'error',
                title: 'เกิดข้อผิดพลาด!',
                text: data.message || 'ไม่สามารถเปลี่ยนแปลงข้อมูลได้',
                confirmButtonText: 'ตกลง',
              });
            }
          })
          .catch(error => {
            Swal.fire({
              icon: 'error',
              title: 'เกิดข้อผิดพลาด!',
              text: 'ไม่สามารถเชื่อมต่อกับเซิร์ฟเวอร์ได้',
              confirmButtonText: 'ตกลง',
            });
          });
      });
    });
    fetchNotifications()
  });
</script>
{% endblock %}