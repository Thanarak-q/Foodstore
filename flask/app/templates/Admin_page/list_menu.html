{% extends 'Admin_page/base.html' %}

{% block content %}
<div id="add-edit" class="container" hidden="hidden">
  <div id="header" class="container">
    <h1>Menu Management</h1>
  </div>
  <div id="add-edit" class="container">
    <h2 id="add-edit-caption">Add/Edit a Menu:</h2>
    <form id="addMenuForm">
      <label for="name">Menu Name</label>
      <input type="text" id="name" name="name" placeholder="Menu Name.." required />
      <label for="description">Description</label>
      <input type="text" id="description" name="description" placeholder="Description.." />
      <label for="price">Price</label>
      <input type="number" id="price" name="price" placeholder="Price.." required />
      <br>
      <label for="category">Category</label>
      <input type="text" id="category" name="category" placeholder="Category.." required />
      <label for="image_url">Image URL</label>
      <input type="text" id="image_url" name="image_url" placeholder="Image URL.." />
      <label for="availability">Availability</label>
      <select id="availability" name="availability" required>
        <option value="true">Available</option>
        <option value="false">Not Available</option>
      </select>
      <input type="hidden" id="menu_id" name="id" />
      <input type="submit" name="submit" value="Submit" />
      <button id="clear_form" type="button">Clear</button>
      <button id="cancel_form" type="button">Cancel</button>
    </form>
  </div>
</div>
<div id="table_display" class="container">
  <button id="add_menu" type="button">Create Menu</button>
  <p></p><br />
  <h2>Menus:</h2>
  <table class="table-striped border-success" id="menu-table">
    <thead>
      <tr>
        <th data-field="name"><span class="text-success"> Menu Name </span></th>
        <th data-field="description"><span class="text-success"> Description </span></th>
        <th data-field="price"><span class="text-success"> Price </span></th>
        <th data-field="category"><span class="text-success"> Category </span></th>
        <th data-field="availability"><span class="text-success"> Availability </span></th>
        <th data-field="image_url"><span class="text-success"> Image URL </span></th>
        <th data-field="operation" data-formatter="actionFormatter" data-events="operateEvents">
          <span class="text-success"> Edit/Delete </span>
        </th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Menu 1</td>
        <td>Description of Menu 1</td>
        <td>$10.00</td>
        <td>Category 1</td>
        <td>Available</td>
        <td>
          <a href="https://example.com/long-image-url.jpg" target="_blank">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏†‡∏≤‡∏û</a>
        </td>
        <td>
          <!-- Edit/Delete buttons here -->
        </td>
      </tr>
      <!-- Add more rows as needed -->
    </tbody>
  </table>
</div>
{% endblock %}

{% block extra_js %}

<script>
      function populate_table(table_data) {
        $('#menu-table').bootstrapTable({
          data: table_data,
          loadingTemplate: function () {
            return '' // ‡πÄ‡∏≠‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "Loading, please wait" ‡∏≠‡∏≠‡∏Å
          }
        })
      }

      $(document).ready(function () {
        ;(function () {
          $.getJSON('/menu/menus', populate_table)
        })()
      })

      function refresh_table(table_data) {
        $('#menu-table').bootstrapTable('load', table_data)
      }

      $('#addMenuForm').submit(function (event) {
        event.preventDefault()

        var formData = {}
        $(':input').each(function () {
          var key = $(this).attr('name')
          var val = $(this).val()
          if (key != 'submit') {
            formData[key] = val
          }
        })

        var $form = $(this)
        var url = '/menu'

        $.post(url, formData, function (table_data) {
          refresh_table(table_data)
          clearForm()
          toggleView()
        })
      })

      function clearForm() {
        $('#addMenuForm')[0].reset()
      }

      function toggleView() {
        if ($('#table_display').attr('hidden')) {
          $('#table_display').removeAttr('hidden')
          $('#add-edit').attr('hidden', 'hidden')
        } else {
          $('#table_display').attr('hidden', 'hidden')
          $('#add-edit').removeAttr('hidden')
        }
      }

      function actionFormatter(value, row, index) {
        return [
          '<a class="edit" href="javascript:void(0)" title="Edit">',
          '‚úèÔ∏è',
          '</a>  ',
          '<a class="remove" href="javascript:void(0)" title="Remove">',
          'üóëÔ∏è',
          '</a>',
        ].join('')
      }

      window.operateEvents = {
        'click .edit': function (e, value, row, index) {
          prePopulateForm(row)
        },
        'click .remove': function (e, value, row, index) {
          removeItem(row)
        },
      }

      function prePopulateForm(row) {
        $('#addMenuForm')[0].reset();
        $('#menu_id').val(row.name);
        $('#name').val(row.name);
        $('#description').val(row.description);
        $('#price').val(row.price);
        $('#category').val(row.category);
        $('#image_url').val(row.image_url);
        $('#availability').val(row.availability.toString());
        toggleView();
      }

      function removeItem(row) {
        if (!confirm('Delete menu with ID ' + row.name + '?')) {
          return false
        }
        var url = '/menu/remove_menu'
        var formData = { id: row.name }
        $.post(url, formData, function (table_data) {
          refresh_table(table_data)
        })
      }

      $('#add_menu').click(function () {
        clearForm()
        toggleView()
      })

      $('#clear_form').click(function () {
        clearForm()
      })

      $('#cancel_form').click(function () {
        clearForm()
        toggleView()
      })
    </script>
{% endblock %}





